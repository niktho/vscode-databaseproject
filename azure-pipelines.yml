trigger:
- master

resources:
  containers:
    - container: my_container
      image: ubuntu:16.04
    - container: testdb
      image: mcr.microsoft.com/mssql/server:2019-latest
      ports: 
      - 1433:1433
      env:
        SA_USER: 'SA'
        SA_PASSWORD: 'Test2019.!'
        ACCEPT_EULA: 'Y'
      command: "/bin/bash /opt/mssql/bin/sqlservr"
    - container: flyway
      image: flyway/flyway:6.3.0
      env:
        FLYWAY_USER : 'SA'
        FLYWAY_PASSWORD : 'Test2019.!'
        FLYWAY_CONNECT_RETRIES : '30'
        FLYWAY_URL: 'jdbc:sqlserver://testdb:1433;databasename=master'
      command: "info"

pool:
  vmImage: 'ubuntu-latest'

container: my_container

services:
  testdb: testdb
  flyway : flyway
steps:
 - script: |
    sleep 20s    
    url https://packages.microsoft.com/keys/microsoft.asc | apt-key add -	
    curl https://packages.microsoft.com/config/ubuntu/16.04/prod.list | tee /etc/apt/sources.list.d/msprod.list	
    apt-get update 	
    apt-get install mssql-tools unixodbc-dev	
    echo 'export PATH="$PATH:/opt/mssql-tools/bin"' >> ~/.bash_profile
    sqlcmd -S testdb -U SA -P "Test2019.!" -j

